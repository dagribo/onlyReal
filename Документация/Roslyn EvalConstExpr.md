### Свертка констант в трехадресном коде.
Локальные оптимизации трехадресного кода. Оптимизация константных выражений.

### Команда Roslyn

#### Постановка задачи
Требуется найти в трехадресном коде выражения, в которых участвуют только константные значения и произвести вычисления найденных выражений на этапе компиляции исходного кода программы.

#### Зависимости задач в графе задач
Задача зависит от:
* генерации трехадресного кода.

#### Теория
В исходном программном коде часто встречаются выражения, в которых принимают участие только константные значения. Примером такого выражения может служить следующий код:
```cpp
int val = 1234 + 4321 - 5555 * (8888/4444 - 1);
bool b = (val < 1) && (true || false) && (3.14 < (val + 4));
```
Подобные выражения можно оптимизировать, если произвести вычисления на этапе компиляции исходного программного кода. Это позволит сделать вычисление программы более быстрым, поскольку все выражения, в которых принимают участие только константы, будут вычислены до запуска программы.

#### Особенности реализации
При использовании кода, производящего оптимизацию свертки констант, следует использовать класс, реализующий каскадные оптимизации трехадресного кода программы AutoThreeCodeOptimiser. Таким образом, последовательность действий для использования данной оптимизации будет следующей:
1) сгенерировать трехадресный код;
2) создать объект *SimpleLang.ThreeCodeOptimisations.AutoThreeCodeOptimiser*;
3) добавить к созданному объекту новый объект типа *SimpleLang.ThreeCodeOptimisations.EvalConstExpr*;
4) вызвать метод Apply объекта AutoThreeCodeOptimiser.
```csharp
using SimpleLang.ThreeCodeOptimisations;
...
AutoThreeCodeOptimiser opt = new AutoThreeCodeOptimiser();
opt.Add(new EvalConstExpr());
opt.Apply(visitor);
```
В данном коде подразумевается, что переменная *visitor* является объектом класса *ThreeAddressCodeVisitor*.


#### Тесты
Для исходного кода 
```csharp
{
	int val;
	val = 1234 + 4321 - 5555 * (8888/4444 - 1);
	bool b;
	b = (val < 1) && (true || false) && (3.14 < (val + 4));
}
```
генератор трехадресного кода генерирует следующий код:
```csharp
    temp_1 = 1234 + 4321
    temp_4 = 8888 / 4444
    temp_3 = temp_4 - 1
    temp_2 = 5555 * temp_3
    temp_0 = temp_1 - temp_2
    val = temp_0
    temp_7 = val < 1
    temp_8 = True || False
    temp_6 = temp_7 && temp_8
    temp_10 = val + 4
    temp_9 = 3.14 < temp_10
    temp_5 = temp_6 && temp_9
    b = temp_5
```
После использования оптимизации свертки констант получается следующий код:
```csharp
    temp_1 = 5555
    temp_4 = 2
    temp_3 = temp_4 - 1
    temp_2 = 5555 * temp_3
    temp_0 = temp_1 - temp_2
    val = temp_0
    temp_7 = val < 1
    temp_8 = True
    temp_6 = temp_7 && temp_8
    temp_10 = val + 4
    temp_9 = 3.14 < temp_10
    temp_5 = temp_6 && temp_9
    b = temp_5
```

Если к выше представленному программному коду, написанном на реализованном языке программирования применить каскадно следующие оптимизации:
* свертка констант;
* распространение констант внутри базового блока;
* живые или мертвые переменные,
то получится с оптимизировать код до следующего:
```csharp
    val = 0
    b = True
```
